<!DOCTYPE html>
<html>
  <head>
    <title>OFraMP</title>
    <meta charset="utf-8" />
    <script type="text/javascript" src="OFraMP.js"></script>
  </head>

  <body>
    <canvas id="myCanvas" width="600" height="420" style="border:1px solid #d3d3d3;">
      Your browser does not support the HTML5 canvas tag.
    </canvas>

    <script>
      function drawLine(ctx, x1, y1, x2, y2) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.closePath();
        ctx.stroke();
      }

      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");

      ctx.font = "12px Arial";
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.strokeStyle = '#000';

      var xh = new XMLHttpRequest();
      xh.open("POST", "http://127.0.0.1:8000/", false);
      xh.setRequestHeader("Content-type", "application/json");
      xh.send("fmt=smiles&data=CCC=O");

      var md = JSON.parse(xh.response);
      console.log(md);
      var m = new Molecule();
      m.init(md.atoms, md.bonds);
      m.atoms.bestFit(600, 420);

      var atoms = m.atoms.atoms;
      for (var i = 0; i < atoms.length; i++) {
        ctx.fillText(atoms[i].element, atoms[i].x, atoms[i].y);
      }

      var bonds = m.bonds.bonds;
      for (var i = 0; i < bonds.length; i++) {
        a1 = bonds[i].a1;
        a2 = bonds[i].a2;
        drawLine(ctx, atoms[a1].x, atoms[a1].y, atoms[a2].x, atoms[a2].y);
      }
    </script>
  </body>
</html>