<!DOCTYPE html>
<html>
  <head>
    <title>OFraMP</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="static/css/style.css" />
    <!--[if IE]><script type="text/javascript" src="static/js/lib/excanvas.js"></script><![endif]-->
    <script type="text/javascript" src="static/js/compatibility/es5.js"></script>
    <script type="text/javascript" src="static/js/compatibility/json3.min.js"></script>
    <script type="text/javascript" src="static/js/compatibility/console.js"></script>
    <script type="text/javascript" src="static/js/compatibility/Element.js"></script>
    <script type="text/javascript" src="static/js/compatibility/Window.js"></script>

    <script type="text/javascript" src="static/js/lib/BrowserDetect.js"></script>
    <script type="text/javascript" src="static/js/lib/dat.gui.js"></script>

    <script type="text/javascript" src="static/js/extensions/extensions.js"></script>
    <script type="text/javascript" src="static/js/extensions/Array.js"></script>
    <script type="text/javascript" src="static/js/extensions/CanvasRenderingContext2D.js"></script>
    <script type="text/javascript" src="static/js/extensions/Date.js"></script>
    <script type="text/javascript" src="static/js/extensions/DOM.js"></script>
    <script type="text/javascript" src="static/js/extensions/MouseEvent.js"></script>
    <script type="text/javascript" src="static/js/extensions/Number.js"></script>
    <script type="text/javascript" src="static/js/extensions/Object.js"></script>
    <script type="text/javascript" src="static/js/extensions/String.js"></script>

    <script type="text/javascript" src="static/js/Tree/Tree.js"></script>
    <script type="text/javascript" src="static/js/Tree/TreeVis.js"></script>

    <script type="text/javascript" src="static/js/Cache/DummyCache.js"></script>
    <script type="text/javascript" src="static/js/Cache/Cache.js"></script>

    <script type="text/javascript" src="static/js/OFraMP/Atom.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/AtomList.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/Bond.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/BondList.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/Molecule.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/MoleculeViewer.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/OFraMP.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/SelectionArea.js"></script>
    <script type="text/javascript" src="static/js/OFraMP/settings.js"></script>

    <script>
      var mv;

      window.onload = function() {
        var OAPoC_URL = document.URL.match(/vps955\.directvps\.nl/) ? "http://vps955.directvps.nl/OAPoC/" : "http://127.0.0.1:8000/";

        var oframp = new OFraMP("oframp", {
          oapoc : {
            url : OAPoC_URL
          }
        });

        // ONLY for debug purposes, TODO : remove
        doframp = oframp;
        mv = oframp.mv;

        var zi = document.getElementById("zoomin");
        zi.onclick = function() {
          mv.zoom(1.1);
        };
        var zo = document.getElementById("zoomout");
        zo.onclick = function() {
          mv.zoom(.9);
        };
        var zp = document.getElementById("zoom");
        zp.onclick = function(e, x, y, z) {
          switch(zp.value) {
            case 'min':
              mv.minimize();
              break;

            case 'max':
              mv.maximize();
              break;

            case 'avg':
              mv.idealize();
              break;

            case 'fit':
              mv.bestFit();
              break;
          }
          zp.value = 'pre';
        };

        var rp = document.getElementById("reset");
        rp.onclick = function() {
          mv.resetPositions();
        };

        var dl = document.getElementById("download");
        dl.onclick = function() {
          var data = mv.canvas.toDataURL('image/png');
          this.href = data.replace(/^data:image\/[^;]/, 'data:application/octet-stream');
          var date = $ext.date.format(new Date(), "%Y%m%d%H%M%S");
          this.download = "OFraMP-" + date + ".png";
        };

        var op = document.getElementById("opti");
        if ($ext.onBrokenIE()) {
          op.remove();
        } else {
          op.onclick = function() {
            oframp.settings_ui.toggle();
          };
        }

        function initControls() {
          var controls = document.getElementById("controls");
          var toggle = document.getElementById("controls_toggle");
          toggle.style.visibility = "visible";

          $ext.dom.onMouseOver(controls, function() {
            toggle.className = "hover";
          });
          $ext.dom.onMouseOut(controls, function() {
            toggle.className = "";
          });

          $ext.dom.onMouseClick(toggle, function() {
            if (controls.style.visibility === "visible") {
              controls.style.height = "0px";
              controls.style.padding = "0px";
              controls.style.visibility = "hidden";
              toggle.style.bottom = "0px";
              toggle.innerHTML = "Controls &#8673";
            } else {
              controls.style.visibility = "visible";
              controls.style.height = "40px";
              controls.style.padding = "5px";
              toggle.style.bottom = "40px";
              toggle.innerHTML = "Controls &#8675";
            }
          });
        }

        $ext.dom.addEventListener(oframp.container, 'molecule_entered', function() {
          initControls();
        });
      };
    </script>
  </head>

  <body>
    <div id="header">
      <span id="logo_o">O</span><span id="logo_fra">Fra</span><span id="logo_m">M</span><span id="logo_p">P</span>
    </div>

    <div id="controls_toggle">
      Controls &#8673;
    </div>

    <div id="controls">
      <div class="bgroup">
        <button id="zoomin" class="border_box">
          Zoom +
        </button>
        <button id="zoomout" class="border_box">
          Zoom -
        </button>
        <select id="zoom" class="border_box">
          <option value="pre" disabled="disabled" selected="selected">Predefined</option>
          <option value="min">Minimal</option>
          <option value="avg">Ideal</option>
          <option value="max">Maximal</option>
          <option value="fit">Best fit</option>
        </select>
      </div>

      <div class="bgroup">
        <button id="reset" class="border_box">
          Reset positions
        </button>
      </div>

      <div class="bgroup">
        <a id="download" class="border_box" href="">Download</a>
      </div>

      <div class="bgroup">
        <button id="opti" class="border_box">
          Settings
        </button>
      </div>
    </div>

    <div id="copyright">
      &copy; 2013 jimivdw | CWI
    </div>

    <div id="oframp"></div>
  </body>
</html>
